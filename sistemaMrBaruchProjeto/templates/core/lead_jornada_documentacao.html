{% extends 'core/doc_base.html' %}


{% block doc_content %}




<style>
  .doc-content-lead * {
    font-size: 0.97rem !important;
  }
  .doc-content-lead h2 {
    font-size: 1.4rem !important;
  }
  .doc-content-lead h3 {
    font-size: 1.13rem !important;
  }
  .doc-content-lead table th, .doc-content-lead table td {
    font-size: 0.95rem !important;
  }
  .doc-banner-lead {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: flex-start;
    height: 160px;
    background: linear-gradient(90deg, #6366f1 0%, #8b5cf6 100%);
    border-radius: 24px;
    margin-bottom: 2.5rem;
    padding: 2.5rem 2.5rem 2.5rem 3.5rem;
    color: #fff;
    position: relative;
  }
  .doc-banner-lead h1 {
    font-size: 2.2rem;
    font-weight: 700;
    margin-bottom: 0.3rem;
    color: #fff;
  }
  .doc-banner-lead p {
    font-size: 1.08rem;
    font-weight: 400;
    margin-bottom: 0;
    color: #e0e7ff;
  }
</style>


<div class="doc-banner-lead">
  <h1>Documentação Técnica - Jornada Lead</h1>
  <p>Documentação completa do fluxo de captação, qualificação e comissionamento de leads</p>
</div>

<div class="doc-content-lead">

<h2 id="visao-geral">Visão Geral da Jornada Lead</h2>
<p>
  O sistema <strong>Lead</strong> gerencia todo o ciclo de vida do potencial cliente, desde o contato inicial até o acompanhamento comercial, com integração completa de pagamentos PIX via ASAAS e comissionamento automático.
</p>
<p><strong>Objetivo:</strong> Automatizar todo o processo de captação, qualificação, pagamento e comissionamento, garantindo rastreabilidade e eficiência operacional.</p>

<h2 id="caracteristicas">Principais Características</h2>
<ul>
  <li>Captura de leads com validação em tempo real</li>
  <li>Integração com ASAAS para pagamentos PIX</li>
  <li>Comissionamento automático</li>
  <li>Auditoria completa de todas as ações</li>
  <li>Acompanhamento comercial integrado</li>
</ul>

<h2 id="tecnologias">Tecnologias Utilizadas</h2>
<ul>
  <li><strong>Backend:</strong> Django/Python</li>
  <li><strong>Frontend:</strong> HTML, CSS, JavaScript</li>
  <li><strong>Banco de Dados:</strong> PostgreSQL</li>
  <li><strong>Pagamentos:</strong> API ASAAS</li>
  <li><strong>Diagramas:</strong> Mermaid.js</li>
</ul>

<h2 id="fluxo">Jornada do Usuário - Fluxo Completo</h2>
<pre><code>
1. Contato Inicial
   ↓
2. Formulário de Atendimento → Cadastro do Lead
   ↓
3. Persistência dos dados → Fez Levantamento?
   ↓
   Não → Acompanhamento Comercial
   Sim → Geração do PIX
   ↓
4. Integração com ASAAS → Webhook ASAAS
   ↓
5. Confirmação de Pagamento → Comissionamento Automático
   ↓
6. Registro para atendente → Acompanhamento Comercial
   ↓
7. Atualização Status
   Lead para Pago → Acompanhamento Comercial
</code></pre>

<h2 id="etapas">Etapas do Fluxo</h2>
<h3>1. Captação Inicial</h3>
<ul>
  <li>Lead chega ao sistema via formulário web, ligação ou indicação</li>
  <li>Dados básicos são coletados (nome, telefone, e-mail opcional)</li>
  <li>Sistema atribui automaticamente um atendente</li>
  <li>Status inicial: <span class="badge bg-primary">NOVO</span></li>
</ul>
<h3>2. Qualificação e Levantamento</h3>
<ul>
  <li>Atendente entra em contato com o lead</li>
  <li>Identifica necessidade de levantamento de informações</li>
  <li>Sistema gera cobrança PIX via integração ASAAS</li>
  <li>Valor configurável: <strong>R$ 0,50</strong> (padrão)</li>
  <li>Status: <span class="badge bg-warning">AGUARDANDO_PAGAMENTO</span></li>
</ul>
<h3>3. Confirmação de Pagamento</h3>
<ul>
  <li>Cliente realiza pagamento via PIX</li>
  <li>Webhook ASAAS notifica o sistema automaticamente</li>
  <li>Sistema atualiza status do lead</li>
  <li>Status: <span class="badge bg-success">LEVANTAMENTO_PAGO</span></li>
</ul>
<h3>4. Comissionamento Automático</h3>
<ul>
  <li>Sistema cria registro de comissão para o atendente</li>
  <li>Valor fixo: <strong>R$ 0,50</strong> (padrão)</li>
  <li>Vinculado ao lead e ao usuário responsável</li>
  <li>Rastreável via painel de comissões</li>
</ul>

<h2 id="painel-configuracoes">Painel de Configurações (Lead)</h2>
<p>O comportamento do fluxo de Lead é governado pelo Painel de Configurações. Abaixo, as chaves relevantes, seus tipos, valores padrão, impacto no sistema, status e o valor atual configurado.</p>
<div class="doc-card">
  <a href="#" class="btn btn-primary">Abrir Painel de Configurações</a>
</div>

<h3>Captura e Cadastro</h3>
<table class="table">
  <thead>
    <tr><th>Chave</th><th>Tipo</th><th>Padrão</th><th>Valor atual</th><th>Impacto</th><th>Status</th></tr>
  </thead>
  <tbody>
    <tr><td>LEAD_OBRIGAR_EMAIL</td><td>Booleano</td><td>false</td><td>Ativo</td><td>Exige e-mail no cadastro do Lead.</td><td>Ativo</td></tr>
    <tr><td>LEAD_OBRIGAR_CPF_PARA_LEVANTAMENTO</td><td>Booleano</td><td>true</td><td>Ativo</td><td>Exige CPF/CNPJ para gerar o PIX do levantamento.</td><td>Ativo</td></tr>
    <tr><td>LEAD_STATUS_INICIAL</td><td>Texto</td><td>NOVO</td><td>Ativo</td><td>Define o status inicial do Lead ao salvar.</td><td>Ativo</td></tr>
  </tbody>
</table>

<h3>PIX e Integração ASAAS</h3>
<table class="table">
  <thead>
    <tr><th>Chave</th><th>Tipo</th><th>Padrão</th><th>Valor atual</th><th>Impacto</th><th>Status</th></tr>
  </thead>
  <tbody>
    <tr><td>PIX_VALOR_LEVANTAMENTO</td><td>Número</td><td>0.50</td><td>Ativo</td><td>Valor da cobrança PIX de levantamento.</td><td>Ativo</td></tr>
    <tr><td>PIX_DESCRICAO</td><td>Texto</td><td>Levantamento de informações (PIX)</td><td>Ativo</td><td>Descrição da cobrança PIX.</td><td>Ativo</td></tr>
    <tr><td>PIX_EXPIRA_MINUTOS</td><td>Número</td><td>60</td><td>Em breve</td><td>Tempo para expiração do PIX (a ser aplicado conforme suporte ASAAS).</td><td>Em breve</td></tr>
    <tr><td>ASAAS_MAX_RETRIES</td><td>Número</td><td>3</td><td>Ativo</td><td>Número máximo de tentativas na API ASAAS.</td><td>Ativo</td></tr>
    <tr><td>ASAAS_TIMEOUT</td><td>Número</td><td>30</td><td>Ativo</td><td>Timeout (segundos) para chamadas ASAAS.</td><td>Ativo</td></tr>
  </tbody>
</table>

<h3>Pagamento, Comissão e Acompanhamento</h3>
<table class="table">
  <thead>
    <tr><th>Chave</th><th>Tipo</th><th>Padrão</th><th>Valor atual</th><th>Impacto</th><th>Status</th></tr>
  </thead>
  <tbody>
    <tr><td>LEAD_STATUS_APOS_PAGAMENTO</td><td>Texto</td><td>LEVANTAMENTO_PAGO</td><td>Ativo</td><td>Status do Lead após pagamento confirmado (Webhook).</td><td>Ativo</td></tr>
    <tr><td>COMISSAO_ATIVA</td><td>Booleano</td><td>true</td><td>Ativo</td><td>Cria registro em Comissão do Lead para o atendente.</td><td>Ativo</td></tr>
    <tr><td>COMISSAO_ATENDENTE_VALOR_FIXO</td><td>Número</td><td>0.50</td><td>Ativo</td><td>Valor fixo da comissão por Lead pago.</td><td>Ativo</td></tr>
    <tr><td>FOLLOWUP_INTERVALO_PADRAO_DIAS</td><td>Número</td><td>2</td><td>Ativo</td><td>Cria notificação para realizar follow-up em N dias.</td><td>Ativo</td></tr>
    <tr><td>LEAD_STATUS_CONTATO</td><td>Texto</td><td>CONTATADO</td><td>Ativo</td><td>Status setado após agendar follow-up.</td><td>Ativo</td></tr>
  </tbody>
</table>

<h3>Auditoria & Logs</h3>
<table class="table">
  <thead>
    <tr><th>Chave</th><th>Tipo</th><th>Padrão</th><th>Valor atual</th><th>Impacto</th><th>Status</th></tr>
  </thead>
  <tbody>
    <tr><td>LOG_ATIVO</td><td>Booleano</td><td>true</td><td>Ativo</td><td>Ativa/Desativa persistência de logs no banco.</td><td>Ativo</td></tr>
    <tr><td>LOG_NIVEL_MINIMO</td><td>Texto</td><td>INFO</td><td>Ativo</td><td>Ignora logs abaixo do nível mínimo.</td><td>Ativo</td></tr>
  </tbody>
</table>
<p class="small">Notas: 1) "Em breve" indica chaves já presentes no painel mas ainda não aplicadas na integração ASAAS; 2) todos os valores podem ser ajustados em tempo real no painel, com auditoria.</p>

<h2 id="etapas-detalhadas">Etapas Detalhadas da Jornada</h2>
<h3>Contato Inicial</h3>
<table class="table">
  <thead>
    <tr><th>Campo</th><th>Tipo</th><th>Obrigatoriedade</th><th>Descrição</th></tr>
  </thead>
  <tbody>
    <tr><td>nome_completo</td><td>String</td><td>Obrigatório</td><td>Nome completo do lead</td></tr>
    <tr><td>telefone</td><td>String</td><td>Obrigatório</td><td>Telefone/WhatsApp</td></tr>
    <tr><td>cpf_cnpj</td><td>String</td><td>Condicional</td><td>CPF ou CNPJ</td></tr>
    <tr><td>email</td><td>String</td><td>Opcional</td><td>E-mail do lead</td></tr>
    <tr><td>origem</td><td>ForeignKey</td><td>Obrigatório</td><td>Origem do lead</td></tr>
    <tr><td>fez_levantamento</td><td>Boolean</td><td>Obrigatório</td><td>Indica se optou por levantamento</td></tr>
  </tbody>
</table>

<h3>Cadastro do Lead</h3>
<table class="table">
  <thead>
    <tr><th>Campo</th><th>Tipo</th><th>Descrição</th></tr>
  </thead>
  <tbody>
    <tr><td>nome_completo</td><td>CharField</td><td>Nome completo do lead</td></tr>
    <tr><td>telefone</td><td>CharField</td><td>Telefone/WhatsApp</td></tr>
    <tr><td>cpf_cnpj</td><td>CharField</td><td>CPF ou CNPJ</td></tr>
    <tr><td>email</td><td>EmailField</td><td>E-mail do lead</td></tr>
    <tr><td>origem</td><td>ForeignKey</td><td>Origem do lead (OrigemLead)</td></tr>
    <tr><td>fez_levantamento</td><td>BooleanField</td><td>Indica se fez levantamento</td></tr>
    <tr><td>status</td><td>CharField</td><td>Status do lead</td></tr>
    <tr><td>captador</td><td>ForeignKey</td><td>Usuário que indicou</td></tr>
    <tr><td>atendente</td><td>ForeignKey</td><td>Usuário que cadastrou</td></tr>
    <tr><td>cliente_asaas</td><td>ForeignKey</td><td>Referência ao cliente na ASAAS</td></tr>
    <tr><td>data_cadastro</td><td>DateTimeField</td><td>Data/hora do cadastro</td></tr>
    <tr><td>data_atualizacao</td><td>DateTimeField</td><td>Data/hora da última atualização</td></tr>
  </tbody>
</table>

<h3>Decisão de Levantamento</h3>
<table class="table">
  <thead>
    <tr><th>Opção</th><th>Próxima Ação</th><th>Status do Lead</th></tr>
  </thead>
  <tbody>
    <tr><td>Não fez levantamento</td><td>Lead segue para acompanhamento comercial</td><td>NOVO</td></tr>
    <tr><td>Fez levantamento</td><td>Inicia processo de cobrança PIX</td><td>LEVANTAMENTO_PENDENTE</td></tr>
  </tbody>
</table>

<h3>Geração do PIX</h3>
<table class="table">
  <thead>
    <tr><th>Campo</th><th>Origem</th><th>Descrição</th></tr>
  </thead>
  <tbody>
    <tr><td>asaas_id</td><td>ASAAS</td><td>Identificador do cliente na ASAAS</td></tr>
    <tr><td>valor</td><td>Sistema</td><td>Valor fixo da cobrança</td></tr>
    <tr><td>pix_copia_cola</td><td>ASAAS</td><td>Código PIX para pagamento</td></tr>
    <tr><td>status_pix</td><td>ASAAS</td><td>Status da cobrança</td></tr>
    <tr><td>payload_pix</td><td>ASAAS</td><td>Dados completos da cobrança</td></tr>
    <tr><td>data_criacao_pix</td><td>Sistema</td><td>Data/hora da geração</td></tr>
  </tbody>
</table>

<h3>Confirmação de Pagamento</h3>
<table class="table">
  <thead>
    <tr><th>Campo</th><th>Valor</th><th>Descrição</th></tr>
  </thead>
  <tbody>
    <tr><td>status_pagamento</td><td>confirmado</td><td>Status do pagamento</td></tr>
    <tr><td>data_pagamento</td><td>Data/hora atual</td><td>Data da confirmação</td></tr>
    <tr><td>id_transacao</td><td>ASAAS</td><td>Identificador da transação</td></tr>
    <tr><td>status</td><td>LEVANTAMENTO_PAGO</td><td>Status atualizado do lead</td></tr>
  </tbody>
</table>

<h3>Comissionamento Automático</h3>
<table class="table">
  <thead>
    <tr><th>Campo</th><th>Tipo</th><th>Descrição</th></tr>
  </thead>
  <tbody>
    <tr><td>lead</td><td>ForeignKey</td><td>Referência ao lead</td></tr>
    <tr><td>atendente</td><td>ForeignKey</td><td>Usuário que recebe a comissão</td></tr>
    <tr><td>valor</td><td>DecimalField</td><td>Valor fixo por lead (R$ 0,50)</td></tr>
    <tr><td>data_criacao</td><td>DateTimeField</td><td>Data/hora do registro</td></tr>
  </tbody>
</table>

<h3>Acompanhamento Comercial</h3>
<table class="table">
  <thead>
    <tr><th>Status</th><th>Descrição</th><th>Condição</th></tr>
  </thead>
  <tbody>
    <tr><td>NOVO</td><td>Lead cadastrado sem levantamento</td><td>fez_levantamento = False</td></tr>
    <tr><td>LEVANTAMENTO_PENDENTE</td><td>Lead com PIX gerado</td><td>PIX gerado, não pago</td></tr>
    <tr><td>LEVANTAMENTO_PAGO</td><td>Lead com pagamento confirmado</td><td>Webhook confirmado</td></tr>
    <tr><td>CONTATADO</td><td>Lead em contato comercial</td><td>Início do acompanhamento</td></tr>
  </tbody>
</table>

<h2 id="estrutura-dados">Estrutura de Dados e Relacionamentos</h2>
<h3>Dados de Auditoria</h3>
<table class="table">
  <thead>
    <tr><th>Campo</th><th>Tipo</th><th>Descrição</th></tr>
  </thead>
  <tbody>
    <tr><td>usuario</td><td>ForeignKey</td><td>Usuário que realizou a ação</td></tr>
    <tr><td>ip</td><td>GenericIPAddressField</td><td>IP do usuário</td></tr>
    <tr><td>modulo</td><td>CharField</td><td>Módulo do sistema</td></tr>
    <tr><td>acao</td><td>CharField</td><td>Tipo de ação</td></tr>
    <tr><td>mensagem</td><td>TextField</td><td>Descrição do evento</td></tr>
    <tr><td>data_evento</td><td>DateTimeField</td><td>Data/hora do evento</td></tr>
  </tbody>
</table>

<h3>Dados Relacionais Dinâmicos</h3>
<table class="table">
  <thead>
    <tr><th>Modelo</th><th>Propósito</th><th>Relacionamento</th></tr>
  </thead>
  <tbody>
    <tr><td>OrigemLead</td><td>Lista de origens</td><td>ForeignKey em Lead</td></tr>
    <tr><td>MotivoContato</td><td>Motivos/perfis emocionais</td><td>ForeignKey em Lead (opcional)</td></tr>
    <tr><td>ClienteAsaas</td><td>Dados do cliente na ASAAS</td><td>ForeignKey em Lead</td></tr>
    <tr><td>PixLevantamento</td><td>Dados da cobrança PIX associada</td><td>OneToOne com Lead</td></tr>
  </tbody>
</table>

<h2 id="validacoes">Validações e Regras de Negócio</h2>
<h3>Validações no Front-end</h3>
<ul>
  <li>Formatação automática de telefone</li>
  <li>Validação de campos obrigatórios</li>
  <li>Seleção dinâmica de origens</li>
  <li>Máscara para CPF/CNPJ</li>
  <li>Validação de e-mail</li>
</ul>
<h3>Regras de Negócio no Backend</h3>
<ul>
  <li>CPF/CNPJ obrigatório apenas para levantamento</li>
  <li>Comissionamento automático após confirmação de pagamento</li>
  <li>Status atualizado via webhook em tempo real</li>
  <li>Log completo de todas as ações do sistema</li>
  <li>Campo atendente para rastreio e comissionamento</li>
</ul>

<h2 id="consideracoes">Considerações Técnicas e Atualizações</h2>
<table class="table">
  <thead>
    <tr><th>Componente</th><th>Alteração</th><th>Impacto</th></tr>
  </thead>
  <tbody>
    <tr><td>Modelo Lead</td><td>Campo consultor → atendente</td><td>Ajuste em todo o sistema</td></tr>
    <tr><td>Comissionamento</td><td>Usa atendente do Lead</td><td>Comissionamento correto</td></tr>
    <tr><td>Backend</td><td>Views e models atualizados</td><td>Funcionamento correto</td></tr>
    <tr><td>Frontend</td><td>Navegação por âncoras</td><td>Menu lateral funcional</td></tr>
  </tbody>
</table>
<ul>
  <li><strong>ASAAS:</strong> Webhooks para atualização em tempo real</li>
  <li><strong>Comissionamento:</strong> Processo automático e auditável</li>
  <li><strong>Auditoria:</strong> Rastreabilidade completa de todas as ações</li>
  <li><strong>Flexibilidade:</strong> Dados dinâmicos configuráveis via admin</li>
  <li><strong>Segurança:</strong> Validações em múltiplas camadas</li>
</ul>

<h2 id="footer">Documentação do Sistema Lead | Versão 2.0 | Última atualização: {{ "now"|date:"d/m/Y" }}</h2>
<p class="small">Documento elaborado para: Equipe de Desenvolvimento e Gestão Comercial</p>


</div>

{% endblock %}
