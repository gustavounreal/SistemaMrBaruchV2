{% extends 'core/doc_base.html' %}

{% block doc_content %}

<h2 id="visao-geral">ğŸ“‹ VisÃ£o Geral</h2>
<p>
  ImplementaÃ§Ã£o completa de um mÃ³dulo de relatÃ³rios gerenciais para o Sistema Mr. Baruch, permitindo 
  anÃ¡lises detalhadas de leads, comissÃµes, vendas e finanÃ§as com <strong>filtros avanÃ§ados</strong> e 
  <strong>exportaÃ§Ã£o de dados</strong>.
</p>

<h2 id="funcionalidades">ğŸ¯ Funcionalidades Implementadas</h2>

<h3 id="painel-principal">âœ… Painel Principal de RelatÃ³rios</h3>
<ul>
  <li>ğŸ“Š <strong>EstatÃ­sticas Gerais</strong>: Total de leads, taxa de conversÃ£o, comissÃµes totais</li>
  <li>ğŸ† <strong>Top 5 Atendentes</strong>: Ranking de performance do perÃ­odo</li>
  <li>ğŸ´ <strong>Cards de MÃ³dulos</strong>: Acesso rÃ¡pido aos relatÃ³rios especÃ­ficos</li>
  <li>ğŸ“ˆ <strong>Indicadores Visuais</strong>: Cards coloridos com mÃ©tricas chave</li>
</ul>

<h3 id="relatorio-leads">âœ… RelatÃ³rio de Leads</h3>

<h4>ğŸ” Filtros AvanÃ§ados:</h4>
<ul>
  <li>PerÃ­odo (7/30/60/90/365 dias ou todos)</li>
  <li>Status (Pago/Pendente/Expirado)</li>
  <li>Atendente especÃ­fico</li>
</ul>

<h4>ğŸ“Š EstatÃ­sticas do PerÃ­odo:</h4>
<ul>
  <li>Total de leads</li>
  <li>Leads pagos (com valor total)</li>
  <li>Leads pendentes</li>
  <li>Leads expirados</li>
</ul>

<h4>Recursos Adicionais:</h4>
<ul>
  <li>ğŸ“‰ <strong>DistribuiÃ§Ã£o por Status</strong>: AnÃ¡lise visual percentual</li>
  <li>ğŸ“‹ <strong>Lista Detalhada</strong>: Ãšltimos 100 leads com informaÃ§Ãµes completas</li>
  <li>ğŸ’¾ <strong>ExportaÃ§Ã£o CSV</strong>: Download dos dados filtrados</li>
</ul>

<h3 id="relatorio-comissoes">âœ… RelatÃ³rio de ComissÃµes</h3>

<h4>ğŸ” Filtros EspecÃ­ficos:</h4>
<ul>
  <li>PerÃ­odo personalizÃ¡vel</li>
  <li>Status de pagamento (Pago/Pendente/Todos)</li>
  <li>Filtro por atendente</li>
</ul>

<h4>ğŸ’° AnÃ¡lise Financeira:</h4>
<ul>
  <li>Total de comissÃµes</li>
  <li>Total pago vs pendente</li>
  <li>Ticket mÃ©dio</li>
  <li>Taxa de pagamento</li>
</ul>

<h4>Recursos Adicionais:</h4>
<ul>
  <li>ğŸ… <strong>Ranking de Atendentes</strong>: Top 10 com destaque visual</li>
  <li>ğŸ“Š <strong>Detalhamento Individual</strong>: Lista completa de comissÃµes</li>
  <li>ğŸ’¾ <strong>ExportaÃ§Ã£o CSV</strong>: RelatÃ³rio completo para contabilidade</li>
</ul>

<h3 id="relatorios-futuros">âœ… RelatÃ³rios Futuros (Placeholder)</h3>
<ul>
  <li>ğŸ›’ <strong>RelatÃ³rio de Vendas</strong>: Em desenvolvimento</li>
  <li>ğŸ’µ <strong>RelatÃ³rio Financeiro</strong>: Em desenvolvimento</li>
  <li>ğŸ¨ <strong>Template "Em Breve"</strong>: Interface elegante com navegaÃ§Ã£o</li>
</ul>

<h2 id="arquitetura">ğŸ—ï¸ Arquitetura TÃ©cnica</h2>

<h3 id="urls">1. URLs</h3>
<p class="text-muted"><code>relatorios/urls.py</code></p>

<pre><code class="language-python">urlpatterns = [
    path('', views.painel_relatorios, name='painel_relatorios'),
    path('leads/', views.relatorio_leads, name='relatorio_leads'),
    path('vendas/', views.relatorio_vendas, name='relatorio_vendas'),
    path('comissoes/', views.relatorio_comissoes, name='relatorio_comissoes'),
    path('financeiro/', views.relatorio_financeiro, name='relatorio_financeiro'),
    path('exportar/&lt;str:tipo&gt;/', views.exportar_relatorio, name='exportar_relatorio'),
]</code></pre>

<p><strong>Namespace:</strong> <code>relatorios</code></p>

<h3 id="views">2. Views</h3>
<p class="text-muted"><code>relatorios/views.py</code></p>

<h4>2.1 painel_relatorios</h4>
<div class="doc-card">
  <p><strong>PropÃ³sito:</strong> Painel principal com visÃ£o geral</p>
  <p class="mb-2"><strong>Funcionalidades:</strong></p>
  <ul class="mb-2">
    <li>EstatÃ­sticas gerais de leads e comissÃµes</li>
    <li>Top 5 atendentes do perÃ­odo (Ãºltimos 30 dias)</li>
    <li>Links para relatÃ³rios especÃ­ficos</li>
  </ul>
  <p class="mb-0"><strong>Query Performance:</strong></p>
  <ul class="mb-0">
    <li><code>aggregate()</code> para totais</li>
    <li><code>values()</code> + <code>annotate()</code> para agrupamentos</li>
    <li>Limita top 5 automaticamente</li>
  </ul>
</div>

<h4>2.2 relatorio_leads</h4>
<div class="doc-card">
  <p><strong>PropÃ³sito:</strong> AnÃ¡lise detalhada de leads</p>
  <p class="mb-2"><strong>Filtros DisponÃ­veis:</strong></p>
  <ul class="mb-2">
    <li><code>periodo</code>: 7, 30, 60, 90, 365, 'todos'</li>
    <li><code>status</code>: PAGO, PENDENTE, EXPIRADO, 'todos'</li>
    <li><code>atendente</code>: ID do usuÃ¡rio ou vazio</li>
  </ul>
  <p class="mb-2"><strong>EstatÃ­sticas Calculadas:</strong></p>
  <ul class="mb-2">
    <li>Total de leads no perÃ­odo</li>
    <li>DistribuiÃ§Ã£o por status</li>
    <li>Valor total (R$ 50,00 por lead pago)</li>
    <li>Lista limitada a 100 registros</li>
  </ul>
  <p class="mb-0"><strong>OtimizaÃ§Ãµes:</strong></p>
  <ul class="mb-0">
    <li><code>select_related('captador')</code> para evitar N+1</li>
    <li>Filtros encadeados eficientes</li>
    <li>PaginaÃ§Ã£o implÃ­cita (100 registros)</li>
  </ul>
</div>

<h4>2.3 relatorio_comissoes</h4>
<div class="doc-card">
  <p><strong>PropÃ³sito:</strong> AnÃ¡lise financeira de comissÃµes</p>
  <p class="mb-2"><strong>Filtros DisponÃ­veis:</strong></p>
  <ul class="mb-2">
    <li><code>periodo</code>: 7, 30, 60, 90, 365, 'todos'</li>
    <li><code>pago</code>: 'pago', 'pendente', 'todos'</li>
    <li><code>atendente</code>: ID do usuÃ¡rio ou vazio</li>
  </ul>
  <p class="mb-2"><strong>EstatÃ­sticas AvanÃ§adas:</strong></p>
  <ul class="mb-2">
    <li>Total de comissÃµes (quantidade e valor)</li>
    <li>Pagas vs Pendentes</li>
    <li>Ticket mÃ©dio calculado</li>
    <li>Taxa de pagamento percentual</li>
    <li>Ranking top 10 atendentes com drill-down</li>
  </ul>
  <p class="mb-0"><strong>OtimizaÃ§Ãµes:</strong></p>
  <ul class="mb-0">
    <li><code>select_related()</code> para FKs</li>
    <li><code>Q objects</code> para filtros condicionais</li>
    <li><code>aggregate()</code> para cÃ¡lculos eficientes</li>
  </ul>
</div>

<h4>2.4 exportar_relatorio</h4>
<div class="doc-card">
  <p><strong>PropÃ³sito:</strong> Exportar dados em CSV</p>
  <p class="mb-2"><strong>Tipos Suportados:</strong></p>
  <ul class="mb-2">
    <li><code>leads</code>: Exporta relatÃ³rio de leads</li>
    <li><code>comissoes</code>: Exporta relatÃ³rio de comissÃµes</li>
  </ul>
  <p class="mb-0"><strong>CaracterÃ­sticas:</strong></p>
  <ul class="mb-0">
    <li><strong>UTF-8 BOM</strong>: Excel reconhece acentuaÃ§Ã£o</li>
    <li><strong>Timestamp no nome</strong>: Evita sobrescritas</li>
    <li><strong>Preserva filtros</strong>: Via <code>request.GET.urlencode</code></li>
    <li><strong>Headers personalizados</strong>: Content-Disposition para download</li>
  </ul>
</div>

<h2 id="exemplos-uso">ğŸ“Š Exemplos de Uso</h2>

<h3>1. Filtrar Leads Pagos do Ãšltimo MÃªs</h3>
<pre><code>URL: /relatorios/leads/?periodo=30&amp;status=PAGO</code></pre>
<div class="doc-alert doc-alert-success">
  <strong>Resultado:</strong>
  <ul class="mb-0">
    <li>Lista de todos os leads pagos nos Ãºltimos 30 dias</li>
    <li>EstatÃ­sticas especÃ­ficas do perÃ­odo</li>
    <li>Valor total calculado (quantidade Ã— R$ 50,00)</li>
  </ul>
</div>

<h3>2. ComissÃµes Pendentes por Atendente</h3>
<pre><code>URL: /relatorios/comissoes/?pago=pendente&amp;atendente=5</code></pre>
<div class="doc-alert doc-alert-success">
  <strong>Resultado:</strong>
  <ul class="mb-0">
    <li>Todas as comissÃµes pendentes do atendente ID 5</li>
    <li>Total a pagar</li>
    <li>Datas de criaÃ§Ã£o</li>
    <li>Leads associados</li>
  </ul>
</div>

<h3>3. Exportar RelatÃ³rio de ComissÃµes</h3>
<pre><code>URL: /relatorios/exportar/comissoes/?periodo=90</code></pre>
<div class="doc-alert doc-alert-success">
  <strong>Resultado:</strong>
  <ul class="mb-0">
    <li>Arquivo CSV: <code>relatorio_comissoes_20251014_153045.csv</code></li>
    <li>UTF-8 com BOM (compatÃ­vel Excel)</li>
    <li>Ãšltimos 90 dias de comissÃµes</li>
  </ul>
</div>

<h2 id="urls-disponiveis">ğŸ”— URLs DisponÃ­veis</h2>

<table class="table">
  <thead>
    <tr>
      <th>URL</th>
      <th>Nome</th>
      <th>DescriÃ§Ã£o</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>/relatorios/</code></td>
      <td><code>relatorios:painel_relatorios</code></td>
      <td>Painel principal</td>
    </tr>
    <tr>
      <td><code>/relatorios/leads/</code></td>
      <td><code>relatorios:relatorio_leads</code></td>
      <td>RelatÃ³rio de leads</td>
    </tr>
    <tr>
      <td><code>/relatorios/comissoes/</code></td>
      <td><code>relatorios:relatorio_comissoes</code></td>
      <td>RelatÃ³rio de comissÃµes</td>
    </tr>
    <tr>
      <td><code>/relatorios/vendas/</code></td>
      <td><code>relatorios:relatorio_vendas</code></td>
      <td>Placeholder vendas</td>
    </tr>
    <tr>
      <td><code>/relatorios/financeiro/</code></td>
      <td><code>relatorios:relatorio_financeiro</code></td>
      <td>Placeholder financeiro</td>
    </tr>
    <tr>
      <td><code>/relatorios/exportar/&lt;tipo&gt;/</code></td>
      <td><code>relatorios:exportar_relatorio</code></td>
      <td>Exportar CSV</td>
    </tr>
  </tbody>
</table>

<h2 id="como-testar">ğŸ§ª Como Testar</h2>

<h3>1. Acessar Painel Principal</h3>
<pre><code>http://localhost:8000/relatorios/</code></pre>
<p>âœ… Deve exibir estatÃ­sticas gerais e top 5 atendentes</p>

<h3>2. Testar Filtros de Leads</h3>
<pre><code>http://localhost:8000/relatorios/leads/</code></pre>
<ul>
  <li>Selecionar "Ãšltimos 7 dias"</li>
  <li>Status "Pago"</li>
  <li>Clicar em "Filtrar"</li>
</ul>
<p>âœ… Lista deve atualizar com leads pagos nos Ãºltimos 7 dias</p>

<h3>3. Testar Ranking de ComissÃµes</h3>
<pre><code>http://localhost:8000/relatorios/comissoes/</code></pre>
<p>âœ… Deve exibir ranking com badges ouro/prata/bronze para top 3</p>

<h3>4. Exportar CSV</h3>
<pre><code>http://localhost:8000/relatorios/exportar/leads/</code></pre>
<p>âœ… Deve fazer download de arquivo CSV com dados formatados</p>

<h2 id="performance">âš¡ Performance e OtimizaÃ§Ãµes</h2>

<h3>Queries Otimizadas</h3>
<ul>
  <li>âœ… <code>select_related()</code> para ForeignKeys (evita N+1)</li>
  <li>âœ… <code>aggregate()</code> para cÃ¡lculos no banco</li>
  <li>âœ… <code>values()</code> + <code>annotate()</code> para agrupamentos eficientes</li>
  <li>âœ… Limites de registros (100 por pÃ¡gina)</li>
</ul>

<h3>RecomendaÃ§Ãµes Futuras</h3>
<ul>
  <li>â³ <strong>Ãndices no BD</strong>: Criar Ã­ndices em colunas filtradas</li>
  <li>â³ <strong>Cache</strong>: Implementar cache para estatÃ­sticas gerais</li>
  <li>â³ <strong>PaginaÃ§Ã£o</strong>: Lazy loading para listas grandes</li>
  <li>â³ <strong>Background Jobs</strong>: Gerar relatÃ³rios pesados em background (Celery)</li>
</ul>

<h2 id="proximos-passos">ğŸš€ PrÃ³ximos Passos</h2>

<h3>Curto Prazo</h3>
<ul>
  <li>â³ <strong>PaginaÃ§Ã£o</strong>: Implementar paginaÃ§Ã£o para listas &gt; 100 registros</li>
  <li>â³ <strong>GrÃ¡ficos</strong>: Adicionar Chart.js para visualizaÃ§Ãµes</li>
  <li>â³ <strong>Filtro de Data</strong>: Adicionar datepicker para perÃ­odos customizados</li>
  <li>â³ <strong>Mais Formatos</strong>: ExportaÃ§Ã£o em Excel (XLSX) e PDF</li>
</ul>

<h3>MÃ©dio Prazo</h3>
<ul>
  <li>â³ <strong>RelatÃ³rio de Vendas</strong>: Implementar quando mÃ³dulo de vendas estiver pronto</li>
  <li>â³ <strong>RelatÃ³rio Financeiro</strong>: Integrar com mÃ³dulo financeiro</li>
  <li>â³ <strong>Dashboard Interativo</strong>: GrÃ¡ficos interativos com drill-down</li>
  <li>â³ <strong>ComparaÃ§Ã£o de PerÃ­odos</strong>: AnÃ¡lise mÃªs a mÃªs, ano a ano</li>
  <li>â³ <strong>Agendamento</strong>: Envio automÃ¡tico de relatÃ³rios por e-mail</li>
</ul>

<h2 id="suporte">ğŸ“ Suporte</h2>

<div class="doc-card">
  <p class="mb-2"><strong>Desenvolvido por:</strong> GitHub Copilot + Equipe Mr. Baruch</p>
  <p class="mb-2"><strong>Data:</strong> 14 de Outubro de 2025</p>
  <p class="mb-0"><strong>Status:</strong> <span class="doc-badge doc-badge-success">PRONTO PARA PRODUÃ‡ÃƒO</span></p>
</div>

{% endblock %}
