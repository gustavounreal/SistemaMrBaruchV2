{% extends 'base/base.html' %}
{% load static %}

{% block title %}Dashboard de Métricas - Gráficos{% endblock %}

{% block extra_css %}
<!-- Google Fonts - Poppins -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

<style>
  /* ==================== FONTE GLOBAL ==================== */
  * {
    font-family: 'Poppins', 'Segoe UI', Arial, sans-serif;
  }
  
  /* ==================== BACKGROUND ANIMADO ==================== */
  body {
    background: linear-gradient(-45deg, #667eea, #764ba2, #f093fb, #667eea);
    background-size: 400% 400%;
    animation: gradientShift 15s ease infinite;
    min-height: 100vh;
    overflow-x: hidden;
  }
    background-size: 400% 400%;
    animation: gradientShift 15s ease infinite;
    min-height: 100vh;
    overflow-x: hidden;
  }
  
  @keyframes gradientShift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }
  
  /* ==================== CONTAINER PRINCIPAL ==================== */
  .dashboard-container {
    background: rgba(255, 255, 255, 0.98);
    backdrop-filter: blur(10px);
    border-radius: 30px;
    padding: 2.5rem;
    margin: 2rem auto;
    max-width: 1600px;
    box-shadow: 0 30px 90px rgba(0,0,0,0.25);
    border: 1px solid rgba(255,255,255,0.3);
    animation: fadeInUp 0.8s ease-out;
  }
  
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  /* ==================== KPI CARDS (MELHORADO) ==================== */
  .kpi-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 20px;
    padding: 2rem 1.5rem;
    text-align: center;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    height: 100%;
    position: relative;
    overflow: hidden;
  }
  
  .kpi-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 100%);
    opacity: 0;
    transition: opacity 0.4s ease;
  }
  
  .kpi-card:hover {
    transform: translateY(-10px) scale(1.02);
    box-shadow: 0 20px 50px rgba(0,0,0,0.3);
  }
  
  .kpi-card:hover::before {
    opacity: 1;
  }
  
  .kpi-card i {
    font-size: 2.5rem;
    margin-bottom: 1rem;
    display: block;
    animation: iconFloat 3s ease-in-out infinite;
  }
  
  @keyframes iconFloat {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
  }
  
  .kpi-card h2 {
    font-size: 3rem;
    font-weight: 800;
    margin-bottom: 0.5rem;
    text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    letter-spacing: -1px;
  }
  
  .kpi-card p {
    font-size: 0.95rem;
    opacity: 0.95;
    margin: 0;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  /* ==================== CHART CARDS (SUPER MELHORADO) ==================== */
  .chart-card {
    background: white;
    border-radius: 20px;
    padding: 2rem;
    margin-bottom: 2rem;
    box-shadow: 0 8px 30px rgba(0,0,0,0.08);
    border: 2px solid #f0f0f0;
    transition: all 0.4s ease;
    position: relative;
    overflow: hidden;
  }
  
  .chart-card::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 4px;
    height: 0%;
    background: linear-gradient(180deg, #667eea, #764ba2);
    transition: height 0.4s ease;
  }
  
  .chart-card:hover {
    box-shadow: 0 15px 50px rgba(0,0,0,0.12);
    border-color: #667eea;
    transform: translateY(-5px);
  }
  
  .chart-card:hover::after {
    height: 100%;
  }
  
  .chart-title {
    font-size: 1.4rem;
    font-weight: 700;
    color: #2d3748;
    margin-bottom: 0.5rem;
    padding-bottom: 1rem;
    border-bottom: 3px solid transparent;
    border-image: linear-gradient(90deg, #667eea, #764ba2, transparent);
    border-image-slice: 1;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  
  .chart-title i {
    font-size: 1.6rem;
  }
  
  .chart-subtitle {
    font-size: 0.9rem;
    color: #718096;
    margin-top: -0.5rem;
    margin-bottom: 1.5rem;
    font-weight: 500;
  }
  
  /* ==================== PAGE HEADER ==================== */
  .page-header {
    text-align: center;
    margin-bottom: 3rem;
    padding-bottom: 2rem;
    border-bottom: none;
    position: relative;
  }
  
  .page-header h1 {
    font-size: 3.5rem;
    font-weight: 900;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 1rem;
    letter-spacing: -2px;
    text-shadow: 0 0 30px rgba(102, 126, 234, 0.3);
  }
  
  .page-header p {
    font-size: 1.1rem;
    color: #4a5568;
    font-weight: 500;
  }
  
  .page-header i {
    font-size: 4rem;
    animation: pulse 2s ease-in-out infinite;
  }
  
  @keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
  }
  
  /* ==================== BUTTON BACK ==================== */
  .btn-back {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 1rem 2.5rem;
    border-radius: 50px;
    font-weight: 700;
    font-size: 1rem;
    transition: all 0.3s ease;
    box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
    text-transform: uppercase;
    letter-spacing: 1px;
  }
  
  .btn-back:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 30px rgba(102, 126, 234, 0.4);
    color: white;
  }
  
  .btn-back:active {
    transform: translateY(-1px);
  }
  
  /* ==================== CHART CONTAINERS ==================== */
  .chart-card {
    position: relative;
  }
  
  .chart-container {
    position: relative;
    height: 400px;
    width: 100%;
    padding: 1rem 0;
  }
  
  .chart-small .chart-container {
    height: 320px;
  }
  
  canvas {
    display: block;
    width: 100% !important;
    height: 100% !important;
    max-width: 100%;
  }
  
  /* ==================== GRADIENTES DOS KPIs ==================== */
  .gradient-bg-1 { 
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  }
  .gradient-bg-2 { 
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
  }
  .gradient-bg-3 { 
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
  }
  .gradient-bg-4 { 
    background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
  }
  .gradient-bg-5 { 
    background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
  }
  .gradient-bg-6 { 
    background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);
  }
  
  /* ==================== ANIMAÇÕES EXTRAS ==================== */
  @keyframes slideInLeft {
    from {
      opacity: 0;
      transform: translateX(-50px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }
  
  @keyframes slideInRight {
    from {
      opacity: 0;
      transform: translateX(50px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }
  
  .row .col-md-4:nth-child(1) .kpi-card {
    animation: slideInLeft 0.6s ease-out;
  }
  
  .row .col-md-4:nth-child(2) .kpi-card {
    animation: fadeInUp 0.6s ease-out 0.1s backwards;
  }
  
  .row .col-md-4:nth-child(3) .kpi-card {
    animation: slideInRight 0.6s ease-out 0.2s backwards;
  }
  
  /* ==================== SCROLLBAR CUSTOMIZADA ==================== */
  ::-webkit-scrollbar {
    width: 12px;
  }
  
  ::-webkit-scrollbar-track {
    background: #f1f1f1;
  }
  
  ::-webkit-scrollbar-thumb {
    background: linear-gradient(180deg, #667eea, #764ba2);
    border-radius: 10px;
  }
  
  ::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(180deg, #764ba2, #667eea);
  }
  
  /* ==================== BADGES E TAGS ==================== */
  .chart-badge {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    padding: 0.3rem 0.8rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    box-shadow: 0 4px 10px rgba(102, 126, 234, 0.3);
  }
  
  /* ==================== RESPONSIVE MELHORADO ==================== */
  @media (max-width: 768px) {
    .dashboard-container {
      padding: 1.5rem;
      margin: 1rem;
      border-radius: 20px;
    }
    
    .page-header h1 {
      font-size: 2.5rem;
    }
    
    .kpi-card h2 {
      font-size: 2.5rem;
    }
    
    .chart-title {
      font-size: 1.2rem;
    }
    
    .chart-container {
      height: 300px;
    }
  }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container">
  
  <!-- Cabeçalho -->
  <div class="page-header">
    <h1>
      <i class="bi bi-graph-up-arrow"></i> Dashboard de Métricas
    </h1>
    <p class="text-muted">Análise visual completa de todas as métricas do sistema</p>
    <a href="{% url 'relatorios:painel_relatorios' %}" class="btn btn-back mt-3">
      <i class="bi bi-arrow-left"></i> Voltar aos Relatórios
    </a>
  </div>

  <!-- KPIs Principais -->
  <div class="row mb-4">
    <div class="col-md-4">
      <div class="kpi-card gradient-bg-1">
        <i class="bi bi-people-fill" style="font-size: 2rem;"></i>
        <h2>{{ kpis.total_leads }}</h2>
        <p>Total de Leads</p>
      </div>
    </div>
    <div class="col-md-4">
      <div class="kpi-card gradient-bg-2">
        <i class="bi bi-check-circle-fill" style="font-size: 2rem;"></i>
        <h2>{{ kpis.total_vendas }}</h2>
        <p>Vendas Fechadas</p>
      </div>
    </div>
    <div class="col-md-4">
      <div class="kpi-card gradient-bg-3">
        <i class="bi bi-percent" style="font-size: 2rem;"></i>
        <h2>{{ kpis.taxa_conversao_geral }}%</h2>
        <p>Taxa de Conversão</p>
      </div>
    </div>
  </div>

  <div class="row mb-4">
    <div class="col-md-4">
      <div class="kpi-card gradient-bg-4">
        <i class="bi bi-currency-dollar" style="font-size: 2rem;"></i>
        <h2>R$ {{ kpis.receita_total|floatformat:2 }}</h2>
        <p>Receita Total</p>
      </div>
    </div>
    <div class="col-md-4">
      <div class="kpi-card gradient-bg-5">
        <i class="bi bi-cart-check-fill" style="font-size: 2rem;"></i>
        <h2>R$ {{ kpis.ticket_medio|floatformat:2 }}</h2>
        <p>Ticket Médio</p>
      </div>
    </div>
    <div class="col-md-4">
      <div class="kpi-card gradient-bg-6">
        <i class="bi bi-calendar-check" style="font-size: 2rem;"></i>
        <h2>{{ kpis.leads_mes_atual }}</h2>
        <p>Leads Este Mês</p>
      </div>
    </div>
  </div>

  <!-- Linha 1: Gráficos de Linha e Funil -->
  <div class="row">
    <div class="col-lg-8">
      <div class="chart-card">
        <h3 class="chart-title">
          <i class="bi bi-graph-up text-primary"></i> Evolução de Leads nos Últimos 12 Meses
        </h3>
        <p class="chart-subtitle">Acompanhe o crescimento mensal de captação</p>
        <div class="chart-container">
          <canvas id="chartLeadsPorMes"></canvas>
        </div>
      </div>
    </div>
    <div class="col-lg-4">
      <div class="chart-card">
        <h3 class="chart-title">
          <i class="bi bi-funnel text-success"></i> Funil de Conversão
        </h3>
        <p class="chart-subtitle">Da captação até a venda</p>
        <div class="chart-container">
          <canvas id="chartFunil"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Linha 2: Status e Origem -->
  <div class="row">
    <div class="col-lg-4">
      <div class="chart-card chart-small">
        <h3 class="chart-title">
          <i class="bi bi-pie-chart text-warning"></i> Leads por Status
        </h3>
        <p class="chart-subtitle">Distribuição por status</p>
        <div class="chart-container">
          <canvas id="chartStatus"></canvas>
        </div>
      </div>
    </div>
    <div class="col-lg-4">
      <div class="chart-card chart-small">
        <h3 class="chart-title">
          <i class="bi bi-diagram-3 text-info"></i> Leads por Origem
        </h3>
        <p class="chart-subtitle">Top 10 fontes de captação</p>
        <div class="chart-container">
          <canvas id="chartOrigem"></canvas>
        </div>
      </div>
    </div>
    <div class="col-lg-4">
      <div class="chart-card chart-small">
        <h3 class="chart-title">
          <i class="bi bi-qr-code text-primary"></i> Status PIX Levantamento
        </h3>
        <p class="chart-subtitle">Situação dos pagamentos PIX</p>
        <div class="chart-container">
          <canvas id="chartPix"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Linha 3: Receita e Parcelas -->
  <div class="row">
    <div class="col-lg-8">
      <div class="chart-card">
        <h3 class="chart-title">
          <i class="bi bi-cash-stack text-success"></i> Receita Mensal (Últimos 12 Meses)
        </h3>
        <p class="chart-subtitle">Evolução de faturamento</p>
        <div class="chart-container">
          <canvas id="chartReceita"></canvas>
        </div>
      </div>
    </div>
    <div class="col-lg-4">
      <div class="chart-card">
        <h3 class="chart-title">
          <i class="bi bi-credit-card text-danger"></i> Parcelas por Status
        </h3>
        <p class="chart-subtitle">Situação das cobranças</p>
        <div class="chart-container">
          <canvas id="chartParcelas"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Linha 4: Top Performers -->
  <div class="row">
    <div class="col-lg-6">
      <div class="chart-card">
        <h3 class="chart-title">
          <i class="bi bi-trophy text-warning"></i> Top 10 Captadores
        </h3>
        <p class="chart-subtitle">Maiores geradores de leads</p>
        <div class="chart-container">
          <canvas id="chartCaptadores"></canvas>
        </div>
      </div>
    </div>
    <div class="col-lg-6">
      <div class="chart-card">
        <h3 class="chart-title">
          <i class="bi bi-star text-success"></i> Top 10 Atendentes
        </h3>
        <p class="chart-subtitle">Maiores atendedores</p>
        <div class="chart-container">
          <canvas id="chartAtendentes"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Linha 5: Conversão e Padrões -->
  <div class="row">
    <div class="col-lg-8">
      <div class="chart-card">
        <h3 class="chart-title">
          <i class="bi bi-arrow-down-up text-info"></i> Taxa de Conversão por Etapa
        </h3>
        <p class="chart-subtitle">Percentual de aproveitamento entre etapas</p>
        <div class="chart-container">
          <canvas id="chartConversao"></canvas>
        </div>
      </div>
    </div>
    <div class="col-lg-4">
      <div class="chart-card">
        <h3 class="chart-title">
          <i class="bi bi-calendar-week text-primary"></i> Leads por Dia da Semana
        </h3>
        <p class="chart-subtitle">Padrão semanal de captação</p>
        <div class="chart-container">
          <canvas id="chartDiaSemana"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Linha 6: Tempo Médio -->
  <div class="row">
    <div class="col-12">
      <div class="chart-card">
        <h3 class="chart-title">
          <i class="bi bi-clock-history text-secondary"></i> Tempo Médio Entre Etapas (Dias)
        </h3>
        <p class="chart-subtitle">Velocidade do processo comercial</p>
        <div class="chart-container">
          <canvas id="chartTempo"></canvas>
        </div>
      </div>
    </div>
  </div>

</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>

<script>
// ==================== CONFIGURAÇÃO GLOBAL MELHORADA ====================
Chart.defaults.font.family = "'Poppins', 'Inter', 'Segoe UI', Arial, sans-serif";
Chart.defaults.font.size = 14;
Chart.defaults.color = '#2d3748';
Chart.defaults.responsive = true;
Chart.defaults.maintainAspectRatio = false;

// ==================== PALETA DE CORES PREMIUM ====================
const colors = {
  primary: [
    '#667eea', '#764ba2', '#f093fb', '#f5576c', 
    '#4facfe', '#00f2fe', '#43e97b', '#38f9d7', 
    '#fa709a', '#fee140', '#30cfd0', '#c471ed'
  ],
  gradient1: '#667eea',
  gradient2: '#764ba2',
  success: '#43e97b',
  warning: '#fee140',
  danger: '#f5576c',
  info: '#4facfe',
};

// ==================== CONFIGURAÇÃO DE TOOLTIPS PERSONALIZADA ====================
const tooltipConfig = {
  backgroundColor: 'rgba(0, 0, 0, 0.9)',
  titleColor: '#fff',
  bodyColor: '#fff',
  padding: 16,
  titleFont: { size: 15, weight: 'bold', family: 'Poppins' },
  bodyFont: { size: 14, family: 'Poppins' },
  borderColor: '#667eea',
  borderWidth: 2,
  cornerRadius: 12,
  displayColors: true,
  boxPadding: 6,
};

// ==================== ANIMAÇÃO PERSONALIZADA ====================
const animationConfig = {
  duration: 1500,
  easing: 'easeInOutQuart',
};

// ========== GRÁFICO 1: Leads por Mês (Linha) ==========
const ctx1 = document.getElementById('chartLeadsPorMes').getContext('2d');
const gradient1 = ctx1.createLinearGradient(0, 0, 0, 400);
gradient1.addColorStop(0, 'rgba(102, 126, 234, 0.6)');
gradient1.addColorStop(0.5, 'rgba(102, 126, 234, 0.3)');
gradient1.addColorStop(1, 'rgba(102, 126, 234, 0.0)');

new Chart(ctx1, {
  type: 'line',
  data: {
    labels: {{ labels_meses|safe }},
    datasets: [{
      label: 'Leads Captados',
      data: {{ leads_por_mes|safe }},
      borderColor: colors.gradient1,
      backgroundColor: gradient1,
      borderWidth: 4,
      fill: true,
      tension: 0.4,
      pointRadius: 6,
      pointHoverRadius: 10,
      pointBackgroundColor: '#fff',
      pointBorderColor: colors.gradient1,
      pointBorderWidth: 3,
      pointHoverBackgroundColor: colors.gradient1,
      pointHoverBorderColor: '#fff',
      pointHoverBorderWidth: 3,
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    animation: animationConfig,
    plugins: {
      legend: { display: false },
      tooltip: tooltipConfig,
    },
    scales: {
      y: { 
        beginAtZero: true,
        grid: { 
          color: 'rgba(0,0,0,0.03)',
          drawBorder: false,
        },
        ticks: {
          padding: 10,
          font: { size: 13, weight: '600' }
        }
      },
      x: { 
        grid: { 
          display: false,
          drawBorder: false,
        },
        ticks: {
          padding: 10,
          font: { size: 13, weight: '600' }
        }
      }
    },
    interaction: {
      intersect: false,
      mode: 'index',
    },
  }
});

// ========== GRÁFICO 2: Status (Pizza) ==========
new Chart(document.getElementById('chartStatus'), {
  type: 'pie',
  data: {
    labels: {{ status_labels|safe }},
    datasets: [{
      data: {{ status_values|safe }},
      backgroundColor: colors.primary,
      borderWidth: 4,
      borderColor: '#fff',
      hoverBorderWidth: 6,
      hoverOffset: 15,
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    animation: {
      ...animationConfig,
      animateRotate: true,
      animateScale: true,
    },
    plugins: {
      legend: { 
        position: 'bottom', 
        labels: { 
          padding: 20,
          font: { size: 12, weight: '600', family: 'Poppins' },
          usePointStyle: true,
          pointStyle: 'circle',
        } 
      },
      tooltip: {
        ...tooltipConfig,
        callbacks: {
          label: function(context) {
            let total = context.dataset.data.reduce((a, b) => a + b, 0);
            let percentage = ((context.parsed / total) * 100).toFixed(1);
            return ' ' + context.label + ': ' + context.parsed + ' (' + percentage + '%)';
          }
        }
      }
    }
  }
});

// ========== GRÁFICO 3: Origem (Doughnut) ==========
new Chart(document.getElementById('chartOrigem'), {
  type: 'doughnut',
  data: {
    labels: {{ origem_labels|safe }},
    datasets: [{
      data: {{ origem_values|safe }},
      backgroundColor: colors.primary,
      borderWidth: 4,
      borderColor: '#fff',
      hoverBorderWidth: 6,
      hoverOffset: 15,
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    cutout: '65%',
    animation: {
      ...animationConfig,
      animateRotate: true,
      animateScale: true,
    },
    plugins: {
      legend: { 
        position: 'bottom', 
        labels: { 
          padding: 18,
          font: { size: 11, weight: '600', family: 'Poppins' },
          usePointStyle: true,
          pointStyle: 'circle',
        } 
      },
      tooltip: tooltipConfig,
    }
  }
});

// ========== GRÁFICO 4: Top Captadores (Barra Horizontal) ==========
const ctx4 = document.getElementById('chartCaptadores').getContext('2d');
const gradient4 = ctx4.createLinearGradient(0, 0, 400, 0);
gradient4.addColorStop(0, 'rgba(102, 126, 234, 0.8)');
gradient4.addColorStop(1, 'rgba(118, 75, 162, 0.8)');

new Chart(ctx4, {
  type: 'bar',
  data: {
    labels: {{ captadores_labels|safe }},
    datasets: [{
      label: 'Leads Captados',
      data: {{ captadores_values|safe }},
      backgroundColor: gradient4,
      borderRadius: 10,
      borderSkipped: false,
      barThickness: 25,
      hoverBackgroundColor: colors.gradient2,
    }]
  },
  options: {
    indexAxis: 'y',
    responsive: true,
    maintainAspectRatio: false,
    animation: animationConfig,
    plugins: {
      legend: { display: false },
      tooltip: tooltipConfig,
    },
    scales: {
      x: { 
        beginAtZero: true,
        grid: {
          color: 'rgba(0,0,0,0.03)',
          drawBorder: false,
        },
        ticks: {
          font: { size: 13, weight: '600' }
        }
      },
      y: {
        grid: { display: false, drawBorder: false },
        ticks: {
          font: { size: 12, weight: '600' }
        }
      }
    }
  }
});

// ========== GRÁFICO 5: Top Atendentes (Barra Horizontal) ==========
const ctx5 = document.getElementById('chartAtendentes').getContext('2d');
const gradient5 = ctx5.createLinearGradient(0, 0, 400, 0);
gradient5.addColorStop(0, 'rgba(67, 233, 123, 0.8)');
gradient5.addColorStop(1, 'rgba(56, 249, 215, 0.8)');

new Chart(ctx5, {
  type: 'bar',
  data: {
    labels: {{ atendentes_labels|safe }},
    datasets: [{
      label: 'Leads Atendidos',
      data: {{ atendentes_values|safe }},
      backgroundColor: gradient5,
      borderRadius: 10,
      borderSkipped: false,
      barThickness: 25,
      hoverBackgroundColor: colors.success,
    }]
  },
  options: {
    indexAxis: 'y',
    responsive: true,
    maintainAspectRatio: false,
    animation: animationConfig,
    plugins: {
      legend: { display: false },
      tooltip: tooltipConfig,
    },
    scales: {
      x: { 
        beginAtZero: true,
        grid: {
          color: 'rgba(0,0,0,0.03)',
          drawBorder: false,
        },
        ticks: {
          font: { size: 13, weight: '600' }
        }
      },
      y: {
        grid: { display: false, drawBorder: false },
        ticks: {
          font: { size: 12, weight: '600' }
        }
      }
    }
  }
});

// ========== GRÁFICO 6: Funil (Barra Vertical) ==========
new Chart(document.getElementById('chartFunil'), {
  type: 'bar',
  data: {
    labels: {{ funil_labels|safe }},
    datasets: [{
      label: 'Quantidade',
      data: {{ funil_values|safe }},
      backgroundColor: [
        colors.gradient1,
        colors.info,
        colors.warning,
        '#f093fb',
        colors.success
      ],
      borderRadius: 8,
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: { display: false },
    },
    scales: {
      y: { beginAtZero: true }
    }
  }
});

// ========== GRÁFICO 7: PIX Status (Pizza) ==========
new Chart(document.getElementById('chartPix'), {
  type: 'pie',
  data: {
    labels: {{ pix_labels|safe }},
    datasets: [{
      data: {{ pix_values|safe }},
      backgroundColor: [colors.success, colors.warning, colors.danger],
      borderWidth: 2,
      borderColor: '#fff',
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: { position: 'bottom', labels: { padding: 15, font: { size: 11 } } },
    }
  }
});

// ========== GRÁFICO 8: Receita (Barra) ==========
const ctx8 = document.getElementById('chartReceita').getContext('2d');
const gradient8 = ctx8.createLinearGradient(0, 0, 0, 400);
gradient8.addColorStop(0, 'rgba(67, 233, 123, 0.8)');
gradient8.addColorStop(1, 'rgba(56, 249, 215, 0.4)');

new Chart(ctx8, {
  type: 'bar',
  data: {
    labels: {{ labels_meses|safe }},
    datasets: [{
      label: 'Receita (R$)',
      data: {{ receita_por_mes|safe }},
      backgroundColor: gradient8,
      borderRadius: 8,
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: { display: false },
      tooltip: {
        callbacks: {
          label: function(context) {
            return 'R$ ' + context.parsed.y.toFixed(2).replace('.', ',');
          }
        }
      }
    },
    scales: {
      y: { 
        beginAtZero: true,
        ticks: {
          callback: function(value) {
            return 'R$ ' + value.toFixed(0);
          }
        }
      }
    }
  }
});

// ========== GRÁFICO 9: Parcelas (Doughnut) ==========
new Chart(document.getElementById('chartParcelas'), {
  type: 'doughnut',
  data: {
    labels: {{ parcelas_labels|safe }},
    datasets: [{
      data: {{ parcelas_values|safe }},
      backgroundColor: [colors.success, colors.warning, colors.danger, colors.info],
      borderWidth: 2,
      borderColor: '#fff',
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: { position: 'bottom', labels: { padding: 12, font: { size: 11 } } },
    }
  }
});

// ========== GRÁFICO 10: Conversão (Linha + Barra) ==========
new Chart(document.getElementById('chartConversao'), {
  type: 'bar',
  data: {
    labels: {{ conversao_labels|safe }},
    datasets: [
      {
        type: 'line',
        label: 'Taxa de Conversão (%)',
        data: {{ conversao_taxa|safe }},
        borderColor: colors.danger,
        backgroundColor: 'rgba(245, 87, 108, 0.1)',
        borderWidth: 3,
        tension: 0.4,
        yAxisID: 'y1',
      },
      {
        type: 'bar',
        label: 'Quantidade',
        data: {{ conversao_counts|safe }},
        backgroundColor: colors.gradient1,
        borderRadius: 8,
        yAxisID: 'y',
      }
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      y: { 
        type: 'linear',
        position: 'left',
        beginAtZero: true,
        title: { display: true, text: 'Quantidade' }
      },
      y1: {
        type: 'linear',
        position: 'right',
        beginAtZero: true,
        max: 100,
        grid: { drawOnChartArea: false },
        title: { display: true, text: 'Taxa (%)' }
      }
    }
  }
});

// ========== GRÁFICO 11: Dia da Semana (Radar) ==========
new Chart(document.getElementById('chartDiaSemana'), {
  type: 'radar',
  data: {
    labels: {{ dias_semana|safe }},
    datasets: [{
      label: 'Leads',
      data: {{ leads_por_dia|safe }},
      backgroundColor: 'rgba(102, 126, 234, 0.2)',
      borderColor: colors.gradient1,
      borderWidth: 2,
      pointBackgroundColor: colors.gradient1,
      pointBorderColor: '#fff',
      pointHoverBackgroundColor: '#fff',
      pointHoverBorderColor: colors.gradient1,
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: { display: false },
    },
    scales: {
      r: {
        beginAtZero: true,
        ticks: { stepSize: 5 }
      }
    }
  }
});

// ========== GRÁFICO 12: Tempo Médio (Barra) ==========
new Chart(document.getElementById('chartTempo'), {
  type: 'bar',
  data: {
    labels: {{ tempo_labels|safe }},
    datasets: [{
      label: 'Dias',
      data: {{ tempo_values|safe }},
      backgroundColor: [
        colors.primary[0],
        colors.primary[2],
        colors.primary[4],
        colors.primary[6]
      ],
      borderRadius: 8,
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: { display: false },
      tooltip: {
        callbacks: {
          label: function(context) {
            return context.parsed.y + ' dias';
          }
        }
      }
    },
    scales: {
      y: { 
        beginAtZero: true,
        title: { display: true, text: 'Dias' }
      }
    }
  }
});
</script>
{% endblock %}
