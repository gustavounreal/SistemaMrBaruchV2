{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PIX da Entrada - Venda #{{ venda.id }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .pix-container {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        .pix-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        .pix-header h3 {
            color: #667eea;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        .pix-header .valor {
            font-size: 2.5rem;
            font-weight: 800;
            color: #2d3748;
            margin: 1rem 0;
        }
        .qr-code-container {
            text-align: center;
            padding: 2rem;
            background: #f7fafc;
            border-radius: 12px;
            margin-bottom: 1.5rem;
        }
        .qr-code-container img {
            max-width: 300px;
            width: 100%;
            border: 4px solid #667eea;
            border-radius: 12px;
            padding: 1rem;
            background: white;
        }
        .copia-cola-section {
            background: #edf2f7;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .copia-cola-section label {
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 0.5rem;
            display: block;
        }
        .codigo-pix {
            background: white;
            border: 2px solid #cbd5e0;
            border-radius: 8px;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            word-break: break-all;
            color: #2d3748;
            max-height: 150px;
            overflow-y: auto;
            margin-bottom: 1rem;
        }
        .btn-copiar {
            width: 100%;
            padding: 1rem;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            transition: all 0.3s ease;
        }
        .btn-copiar:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }
        .btn-copiar.copiado {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }
        .info-venda {
            background: #fff5f5;
            border-left: 4px solid #fc8181;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
        }
        .info-venda p {
            margin: 0.25rem 0;
            color: #2d3748;
            font-size: 0.9rem;
        }
        .btn-finalizar {
            width: 100%;
            padding: 0.75rem;
            border-radius: 8px;
            margin-top: 1rem;
        }
        .alert-success {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: none;
            animation: slideIn 0.3s ease;
        }
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="pix-container">
        <div class="pix-header">
            <h3><i class="bi bi-qr-code me-2"></i>PIX da Entrada</h3>
            <p class="text-muted mb-0">Venda #{{ venda.id }} - {{ venda.cliente.nome_completo }}</p>
            <div class="valor">R$ <span class="format-brl">{{ pix_entrada.valor|floatformat:2 }}</span></div>
        </div>

        <div class="info-venda">
            <p><strong><i class="bi bi-info-circle me-2"></i>Informações Importantes:</strong></p>
            <p>• O pagamento deve ser realizado via PIX</p>
            <p>• Utilize o QR Code ou Copia e Cola abaixo</p>
            <p>• Após o pagamento, o status será atualizado automaticamente</p>
        </div>

        <!-- QR Code -->
        {% if pix_entrada.pix_qr_code_url %}
        <div class="qr-code-container">
            <p class="text-muted mb-3"><i class="bi bi-camera me-2"></i>Escaneie com o app do seu banco</p>
            <img src="{{ pix_entrada.pix_qr_code_url }}" alt="QR Code PIX" id="qrCodeImg">
        </div>
        {% endif %}

        <!-- Copia e Cola -->
        {% if pix_entrada.pix_code %}
        <div class="copia-cola-section">
            <label><i class="bi bi-clipboard me-2"></i>Código Copia e Cola</label>
            <div class="codigo-pix" id="codigoPix">{{ pix_entrada.pix_code }}</div>
            <button type="button" class="btn btn-copiar" id="btnCopiar" onclick="copiarCodigo()">
                <i class="bi bi-clipboard-check me-2"></i>Copiar Código PIX
            </button>
        </div>
        {% endif %}

        <!-- Botões de ação -->
        <div class="d-grid gap-2">
            <a href="{% url 'vendas:detalhes_venda' venda.id %}" class="btn btn-outline-primary btn-finalizar">
                <i class="bi bi-eye me-2"></i>Ver Detalhes da Venda
            </a>
            <a href="{% url 'vendas:painel_leads_pagos' %}" class="btn btn-outline-secondary btn-finalizar">
                <i class="bi bi-arrow-left me-2"></i>Voltar ao Painel
            </a>
        </div>
    </div>

    <!-- Alert de sucesso -->
    <div class="alert alert-success alert-dismissible fade show" role="alert" id="alertCopiar">
        <i class="bi bi-check-circle me-2"></i>
        <strong>Código copiado!</strong> Cole no app do banco para efetuar o pagamento.
        <button type="button" class="btn-close" onclick="fecharAlert()"></button>
    </div>

    <script>
        function copiarCodigo() {
            const codigoPix = document.getElementById('codigoPix').textContent;
            const btnCopiar = document.getElementById('btnCopiar');
            const alertCopiar = document.getElementById('alertCopiar');

            // Copia para clipboard
            navigator.clipboard.writeText(codigoPix).then(() => {
                // Feedback visual no botão
                btnCopiar.classList.add('copiado');
                btnCopiar.innerHTML = '<i class="bi bi-check-circle me-2"></i>Código Copiado!';
                
                // Mostra alert
                alertCopiar.style.display = 'block';
                
                // Reseta botão após 3 segundos
                setTimeout(() => {
                    btnCopiar.classList.remove('copiado');
                    btnCopiar.innerHTML = '<i class="bi bi-clipboard-check me-2"></i>Copiar Código PIX';
                }, 3000);

                // Fecha alert após 5 segundos
                setTimeout(() => {
                    alertCopiar.style.display = 'none';
                }, 5000);
            }).catch(err => {
                alert('Erro ao copiar código. Tente selecionar e copiar manualmente.');
                console.error('Erro:', err);
            });
        }

        function fecharAlert() {
            document.getElementById('alertCopiar').style.display = 'none';
        }
    </script>
</body>
</html>
